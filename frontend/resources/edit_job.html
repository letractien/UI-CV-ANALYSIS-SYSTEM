<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Description</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">    
</head>
<body>
    <header class="d-flex justify-content-between align-items-center p-2 bg-light border-bottom">
        <div class="d-flex align-items-center">
            <img src="/frontend/static/image/logo.png" alt="Company Logo" width="40" height="40" class="me-2">
            <h5 class="m-0">LT Company</h5>
        </div>
        <button class="btn btn-outline-secondary">
            <i class="fas fa-bell"></i>
        </button>
    </header>

    <div class="d-flex">
        <aside class="bg-light p-3" style="min-width: 250px; height: calc(100vh - 75px);">
            <div class="text-center mb-3">
                <img src="/frontend/static/image/face.jpg" class="rounded-circle" width="50" height="50">
                <h5 class="mt-2">Garo</h5>
                <p class="text-muted">HR Manager</p>
            </div>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a href="/" class="nav-link text-dark d-flex align-items-center gap-2"><i class="fas fa-chart-line"></i>Dashboard</a>
                </li>
                <li class="nav-item">
                    <a href="/job" class="nav-link d-flex align-items-center gap-2 active"><i class="fas fa-users"></i>Job</a>
                </li>
            </ul>
            <ul class="nav flex-column position-absolute bottom-0 start-0 p-3">
                <li class="nav-item">
                    <a href="#" class="nav-link text-dark d-flex align-items-center gap-2">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link text-dark d-flex align-items-center gap-2">
                        <i class="fas fa-cog"></i>
                        <span>Setting</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="container p-4" style="overflow-y: auto; height: calc(100vh - 75px);">
            <h1 class="mb-4">Job Description</h1>
            <form onsubmit="submitForm(event)">
                <div class="mb-3">
                    <label for="name" class="form-label fw-bold">Name JD</label>
                    <input type="text" class="form-control" id="name" placeholder="Enter name JD">
                </div>
                
                <h5>Background evaluation criteria</h5>
                <div id="background" class="mb-3"></div>
                <button type="button" class="btn btn-secondary mb-4" onclick="addCriterion('background')">+ Add Criterion</button>
                
                <h5>Project evaluation criteria</h5>
                <div id="project" class="mb-3"></div>
                <button type="button" class="btn btn-secondary mb-4" onclick="addCriterion('project')">+ Add Criterion</button>
                
                <h5>Skill evaluation criteria</h5>
                <div id="skill" class="mb-3"></div>
                <button type="button" class="btn btn-secondary mb-4" onclick="addCriterion('skill')">+ Add Criterion</button>
                
                <h5>Certification evaluation criteria</h5>
                <div id="certification" class="mb-3"></div>
                <button type="button" class="btn btn-secondary mb-4" onclick="addCriterion('certification')">+ Add Criterion</button>
                
                <div class="text-end mt-4">
                    <button type="submit" class="btn btn-primary">+ Save JD</button>
                </div>
            </form>
        </main>
    </div>

    <script>
        async function submitForm(event) {
            event.preventDefault();
    
            const data = {
                name: document.getElementById("name").value,
                background: getCriteria("background"),
                project: getCriteria("project"),
                skill: getCriteria("skill"),
                certification: getCriteria("certification"),
            };
    
            try {
                await fetch("http://localhost:8000/addjob", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data),
                });

                window.location.replace("/index");
            } catch (error) {
                console.error("Error:", error);
                alert("Failed to add job!");
            }

        }
    
        function getCriteria(sectionId) {
            const section = document.getElementById(sectionId);
            const rows = section.querySelectorAll(".criterion-row");
            return Array.from(rows).map(row => {
                const criterion = row.querySelector("input[type='text']").value;
                const point = row.querySelector("input[type='number']").value;
                return { criterion, point: parseInt(point) };
            });
        }
    </script>
    <script>
        async function fetchData() {
            try {
                let response = await fetch("http://localhost:8000/geteval");
                if (!response.ok) throw new Error("Lỗi khi lấy dữ liệu");

                let result = await response.json();
                let data = result.data;

                data.forEach(item => {
                    addCriterion(item.category.toLowerCase(), item.criterion, item.score);
                });
            } catch (error) {
                console.error("Lỗi:", error);
            }
        }

        function addCriterion(sectionId, criterion = "", point = 1) {
            let section = document.getElementById(sectionId);
            if (!section) return;
            
            let div = document.createElement("div");
            div.className = "mb-3 d-flex align-items-center gap-2 criterion-row";
            div.innerHTML = `
                <input type="text" class="form-control w-75" placeholder="Criterion" value="${criterion}">
                <input type="number" class="form-control w-25" placeholder="Point" min="1" value="${point}">
                <button type="button" class="btn btn-danger btn-sm" onclick="removeCriterion(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            section.appendChild(div);
        }

        function removeCriterion(button) {
            button.parentElement.remove();
        }

        window.onload = fetchData;
    </script>
</body>
</html>
